# MFS

MooseFS(Moose File System,MFS), 是一个具备冗余容错功能的分布式网络文件系统

* 高可靠性: 每一份数据可以设置多个备份,并存储在不同的主机上
* 高可扩展性: 通过增加磁盘和主机数量动态扩容整个文件系统的容量
* 高科容错性: 具有一个时间限制的全局回收站(Trash)
* 高一致性: 在文件被写入,访问时,依然可以完成对文件的一致性快照

MFS 分为两个版本: MFS(社区版) 和 MFS pro(商业版),相比社区版,商业版具有多主节点特性,并且有原生 Windows Client

MFS 目前是单主节点,并且对内存要求略高,处理一百万个文件chunkserver 需要约300MB内存

MFS 适用于高并发的线上数据存储及访问

## MFS 集群

![MFS集群](Pics\moosefs-architecture.png)

MFS 集群由四部分组件构成:

* 管理服务器(managing server/master)
  mfs 集群的主服务器,分发用户请求,存储整个文件系统数据文件的 metadata;并且是存在内存中的,会定期写入 `metadata.mfs.back`文件,操作实时写入`changelog.*.mfs`文件;master启动时会将 metadata.mfs 载入内存,重命名为 `metadata.mfs.back`
* 元数据备份服务器(Metadata backup servers/metaloggers)
  备份master 的 metadata 文件和其变化的日志文件,文件类型为 `changelog_ml.*.mfs`
* 数据存储服务器组(data servers/chunk servers)
  存储数据文件的实体,文件以 chunk 大小存储,chunk 最大为64MB;块的生成遵循规则:目录循环写入(00-FF 256个目录,step 为2),chunk 文件递增生成,大文件切分目录连续,chunkserver 需要留有多余空间;文件可以有多分 copy,但 goal 的大小不要超过 chunk server的数量
* 客户机服务组(client servers/client)
  挂载并使用 mfs 的客户端,是通过 fuse mechanism 实现挂载 mfs 文件系统的

