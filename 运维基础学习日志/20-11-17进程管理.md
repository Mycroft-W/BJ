# 进程管理

* 程序:代码集合,用于完成特定任务
* 进程:程序启动后,分配资源的单位,进程需要占据内存/CPU等资源,会分配一个进程号
* 线程:是进程的实际运行的实例,单个进程可以有多个线程,占用 CPU 时间资源.

部分程序的运行要依赖某一终端,关闭终端时,进程会受影响;部分程序可以脱离终端运行

可以使用以下命令切断程序运行对终端的依赖

```shell
nohup <commands> & # 将命令的运行放入后台,并切断与终端的联系
```

由于切断了与终端的联系,所以无法将命令的输出发送到屏幕, nohup 会将输出信息都保存在 nohup.out 文件中

## 进程管理命令

1. 判断服务器的运行状态,资源的利用率是否正常
2. 判断进程的状态,进程是否正常运行
3. 判断进程是否合法,对于非法进程要及时关闭,并追溯源头

### pstree 命令

显示 Linux 中的进程树状结构图

```shell
pstree
    -c # 取消进程树的折叠
    -p # 显示所有进程的进程号
    -u # 列出进程的运行用户
```

### ps 命令

查看 Linux 中的所有进程的详细信息

```shell
ps
    a # 列出所有终端(tty,pts/N)都列出
    u # 面向用户输出,信息更全面
    x # 列出以你的身份(和 ps 相同的 EUID)运行的进程,和 a 同时使用显示所有
```

ps aux 命令的结果含义:

| 关键词  | 描述                                                   |
| ------- | ------------------------------------------------------ |
| USER    | 进程对应的用户                                         |
| PID     | 进程的PID                                              |
| %CPU    | 占用 CPU 的百分比(进程的 CPU 时间除以进程运行的总时间) |
| %MEM    | 进程占用内存的百分比                                   |
| VSZ     | 虚拟内存大小,单位kb                                    |
| RSS     | 物理内存,常驻内存,单位kb                               |
| TTY     | 当前进程所在终端                                       |
| STAT    | 进程状态                                               |
| START   | 进程的开始运行时间                                     |
| TIME    | 进程占用 CPU 时长(格式:分钟:秒)                        |
| COMMAND | 进程执行的命令                                         |

进程状态有以下几种

| 标志 | 描述                                               |
| ---- | -------------------------------------------------- |
| R    | 正在运行                                           |
| S    | 睡眠状态(可以中断)                                 |
| D    | 等待状态;一般是网络或磁盘传输类型进程              |
| T    | 停止状态;一般见不到,因为结束后会消失               |
| Z    | 僵死状态;父进程被意外结束,残留的子进程(被系统回收) |
| +    | 在前台运行的进程                                   |
| l    | 多线程的进程                                       |
| N    | 优先级较低的进程                                   |
| <    | 优先级较高的进程                                   |
| s    | 该进程有子进程                                     |

```shell
ps
    -e # 列出所有进程
    -f # 显示进程的长格式信息
```

信息描述

| 关键词 | 描述              |
| ------ | ----------------- |
| PID    | 进程的PID号       |
| PPID   | 进程的父进程PID号 |
| C      | CPU 的使用时间    |
| STIME  | 进程的启动时间    |
| TIME   | 运行时长          |
| CMD    | 进程的命令        |

```shell
ps
    -efH # 显示所有进程的关系树状结构
```

### top 命令

实时显示进程信息,默认三秒刷新一次

显示信息

第一行:当前时间;系统运行时间(up);登录用户数量;系统平均负载(1,5,15分钟)

第二行:进程数量的统计:总数,正在运行,睡眠,停止,僵死

第三行:cpu 的使用情况:

​   us:用户执行的进程所占用的 CPU 的资源的百分比

​   sy:内核本身运行时所占用的 CPU 的资源百分比

​   ni:修改过进程优先级的进程所占的 CPU 的资源百分比

​   id: CPU 处于空闲状态的百分比

第四行:物理内存的使用情况

​   total:总内存量

​   free:空闲内存量

​   used:正在使用的内存量

​   buff/cache:作为缓存的内存量

​   total=free+used+buff/cache

第五行:虚拟内存(交换分区)使用情况

​   total:总内存量

​   free:空闲内存量

​   used:正在使用的内存量

​   avail Mem:当启动进程时,若不使用 swap 空间,真实物理内存的可用空间

PR:进程的优先级,显示的为进程优先级的最终值

​   PRI(最终值)=PRI(初始值)+NI

​   PRI(初始值)为 20 (不能更改)

NI:通过 NI 值来调整PRI值

​   范围: -20--19

​   命令: nice

​       超级管理员:可以调整为 -20--19之间的大小

​       普通管理员:只能使用 0--19 大小,普通用户只能在进程优先级的基础上,降低进程的优先级

```shell
nice -n N <command> # 指定运行时的优先级
renice -n N <PID> # 修改进程的优先级
```

PR的值越小,进程的优先级越高,在分配 CPU 资源时,优先

top 的升级版: htop

### pgrep 命令

```shell
pgrep <processname> # 通过进程名查看PID
    -a # 同时显示执行的命令
```

### kill 命令

通过向指定进程发送信号的方式,操作进程

```shell
kill -s <signal> PID # 给进程发送信号(通过进程号)
```

kill 可使用的信号:

| 信号    | 数值 | 描述                                    |
| ------- | ---- | --------------------------------------- |
| STGHUP  | 1    | 不停止进程,重新加载配置文件             |
| SIGINT  | 2    | 强制终止当前进程,等同于\<C-c>            |
| SIGKILL | 9    | 强制杀死指定进程                        |
| SIGTERM | 15   | 终止进程的运行,正常终止,kill 的默认信号 |
| SIGCONT | 18   | 唤起停止的进程                          |
| SIGSTOP | 19   | 停止(暂停)进程,等同于\<C-z>              |

### killall 命令

使用和 kill 相同的信号

```shell
killall -s <signal> POCESSNAME # 通过进程名发信号
```

### pkill 命令

使用和 kill 相同的信号,对象时链接 Linux 的终端进程

```shell
pkill -t <终端号>

pkill -9 -t tty/pts # 强制杀死登录终端
```

### uptime 命令

当前时间;系统运行时间(up);登录用户数量;系统平均负载(1,5,15)

### vmstat 命令

进程:

​   r:可运行的进程数,等待运行的进程数

​   b:处于不可中断状态的进程数

内存:

​   swap:虚拟内存的使用量

​   free:处于空闲的内存

​   buff:作为缓冲区的内存空间

​   cache:作为缓存的内存空间

swap:

​   si:从磁盘写入交换内存的效率

​   so:从交换内存写入硬盘的效率

IO: INPUT&OUTPUT

​   参照对象是操作系统

​   bi:从块设备写入系统的效率

​   bo:从系统写入 block 块的效率

system:

​   in: 每秒中断的次数

​   cs:每秒上下文切换的次数

cpu:

​   us:用户执行的进程所占的 CPU 的资源的百分比

​   sy:内核本身运行时所占用的 CPU 的资源百分比

​   id:CPU 处于空闲状态的百分比

​   wa:CPU 处于 IO 等待状态时间

​   st:stolen 虚拟机占据的时间

### iostat 命令

块设备和字符设备的传输效率

### dstat 命令

vmstat 的升级版

### glances 命令

实时统计观察 Linux 各项资源的使用情况

安装方法:

* 配置 yum 拓展源,使用 yum 安装
* 使用 pip 安装

### free 命令

查看内存的使用情况(含有虚拟内存)

```shell
free
    -h # 使用合适大小单位显示
```

### 将命令放入后台

1. 在命令后添加 &
2. 使用\<C-z>

查看后台工作

```shell
jobs # 列出后台工作和工作号
```

使用工作号恢复状态

```shell
fg # 将后台暂停了的进程恢复到前台继续运行
bg # 将后台暂停了的进程恢复到后台运行
# 格式
bg 工作号
#+-：代表最近两次修了状态的工作号
```

```shell
uname -a # 查看当前系统的内核类型和内核版本
```
