# shell 语法

## 条件判断

```bash
[ 判断语句 ] # 注意空格
```

### 判断文件类型

```bash
[ 选项 文件 ]
```

判断文件类型的前提,文件存在,判断符合时返回0

| 判断选项 | 描述             |
| -------- | ---------------- |
| -b       | 是否为块设备     |
| -c       | 是否为字符设备   |
| -d       | 是否为目录文件   |
| -e       | 是否存在         |
| -f       | 是否为普通文件   |
| -L       | 是否为符号链接   |
| -p       | 是否为管道文件   |
| -s       | 是否为空         |
| -S       | 是否为套接字文件 |

```bash
[ -b file ];echo $?
[ -e file ] && echo yes || echo no
```

### 判断文件权限

有对应权限时返回0

| 选项 | 描述             |
| ---- | ---------------- |
| -r   | 是否有读权限     |
| -w   | 是否有写权限     |
| -x   | 是否有执行权限   |
| -u   | 是否有 SUID 权限 |
| -g   | 是否有 SGID 权限 |
| -k   | 是否有 SBit 权限 |

### 文件比较

```bash
[ file1 选项 file2 ]
```

| 选项 | 描述                          |
| ---- | ----------------------------- |
| -nt  | 判断文件1是否比2新(修改时间)  |
| -ot  | 判断文件1是否比2旧(修改时间)  |
| -ef  | 两文件 Inode 是否相同(硬链接) |

```bash
[ file1 -ef file2 ];echo $?
```

### 整数比较

```bash
[ A 选项 B ]
```

| 选项 | 描述           |
| ---- | -------------- |
| -eq  | A是否等于B     |
| -ne  | A是否不等于B   |
| -gt  | A是否大于B     |
| -lt  | A是否小于B     |
| -ge  | A是否大于等于B |
| -le  | A是否小于等于B |

### 字符串判断

| 选项               | 描述                     |
| ------------------ | ------------------------ |
| -z strings         | 字符串是否为空           |
| -n strings         | 字符串是否非空           |
| string1 == string2 | 字符串1是否等于字符串2   |
| string1 != string2 | 字符串1是否不等于字符串2 |

### 多重判断

| 选项               | 描述                            |
| ------------------ | ------------------------------- |
| 条件1 -a 条件2     | 与,条件1和条件2同时成立,返回0   |
| 条件1 -o 条件2     | 或,条件1和条件2有一个成立,返回0 |
| ! 条件(之间有空格) | 非,条件取反                     |

```bash
[ -f file -a -w file];echo $?
```

## 流程控制

对脚本运行过程进行控制,以下的控制语句都可以嵌套使用

### if 条件判断

使用 if 进行条件判断,如果符合条件,则执行 then 语句,然后结束 if 语句;如不符合则跳过 then 语句,顺序向后执行,到 fi 语句时结束 if 语句

```bash
# 形式1
if [ 条件 ];then
    commands
fi
# 形式2
if [ 条件 ]
then
    commands
fi
# 双分支
if [ 条件 ]
then
    commands
else
    commands
fi
# 多分支
if [ 条件 ]
then
    commands
elif [ 条件 ]
then
    commands
...
fi
```

### case 分支选择

case 与 if 的多分支类似,是从多种条件中找出符合的

```bash
case $var in
value1)
    command
    ;;
value2)
    command
    ;;
...
*)
    command
    ;;
esac
```

case 会将变量值与条件中的值对比,相同时执行后面的命令

### for 循环

for 常用于有限次数的循环,有两种形式,执行的方式有些区别

```bash
# 形式1
# 每次循环从列表中取值,直到列表用尽
for var in value1 value2 ...
do
    commands
done
# 形式2
# 顺序是Exp1,EXP2,commands,EXP3;持续循环直到条件不符合
for ((EXP1;EXP2;EXP3))
do
    commands
done
```

### while 循环

只要条件判断成立,就会持续循环,直到不成立,循环停止;常用于无限循环

```bash
while [ 条件 ]
do
    commands
done
```

### until 循环

与 while 相反,当条件满足时,停止循环

```bash
until [ 条件 ]
do
    commands
done
```

### 函数

```bash
# 定义形式1
function 函数名() {
    commands
}
# 形式2
函数名() {
    commands
}
```

在调用函数时,直接使用函数名即可;在调用之前定义函数

#### 函数中的位置变量

```bash
# 给函数传参
函数 参数1 参数2 ...
# 在函数内部使用传递的参数(位置对应)
$1 $2 ...
```

## 特殊语句

### exit

在终端中使用,退出终端

在脚本中是退出脚本

```bash
exit [value] # 指定退出时状态码
```

### break

结束循环语句,执行后面的命令

```bash
break [value] # 在多层循环中时,指定跳出的层数
```

### continue

结束当前一次循环过程,开始下一次循环

```bash
continue [value] # 在多层循环中时,指定层数
```
