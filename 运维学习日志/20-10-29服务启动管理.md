# 服务启动管理

CentOS 6 中使用的初始化服务是 system V,无法并行启动服务,效率差

CentOS 7 中使用的初始化服务是 systemd,支持服务的并行启动,同时增加了日志管理

这种管理工具只适用于使用包管理系统安装的软件(rpm|yum 安装的)

对于源码安装的软件,使用软件命令的绝对路径进行管理,例如:

```shell
/usr/local/apache2/bin/apachectl start|stop|restart|reload|status...
```

## CentOS 6

### 系统运行级别:

文件 /etc/inittab
		通过修改该文件,修改默认运行等级

| 级别  | 描述                             |
| ----- | -------------------------------- |
| init0 | 关机                             |
| init1 | 单用户模式(救援模式)             |
| init2 | 多用户终端模式,没有NFS(没有网络) |
| init3 | 完全的多用户终端模式             |
| init4 | 未使用                           |
| init5 | 多用户的图形化桌面模式           |
| init6 | 重启                             |

### 自启

```shell
chkconfig 服务名 on|off 
chkconfig --level 35 httpd on # 指定自启的级别
```

### 手动

```shell
service 服务名 指令(start|stop|restart|reload|status|...)
```

### 查看

```shell
chkconfig --list
```

并不适用于所有服务,有些服务从属于更大的服务,通过上层软件进行管理,例如:telnet-server

telnet-server 从属于 xinetd 服务,所以需要先开启 xinetd 服务

## CentOS 7

### 运行级别

在 systemd 中取消了运行级别的说法,改用 target 来代替,为了兼容考虑,与运行级别有对应关系(runlevel*.target 是软链接)

| target            | 对应级别    | 描述             |
| ----------------- | ----------- | ---------------- |
| poweroff.target   | runlevel0   | 关机             |
| rescue.target     | runlevel1   | 救援模式         |
| multi-user.target | runlevel2-4 | 多用户的终端模式 |
| graphical.target  | runlevel5   | 图形化模式       |
| reboot.target     | runlevel6   | 重启             |

文件 /etc/systemd/system/\*.target

其中的 default.target 是默认运行级别,是某个 target 的软链接

可以直接修改软连接,也可以通过以下命令修改默认运行级别

```shell
systemctl set-default 某个target
```

### 启动

自动

```shell
systemctl enable|disable 服务名.service
```

系统存在一个默认开机自启的软件的软件链接目录: /etc/systemd/system/[multi-user].target.wants

其中[]中的是运行等级,在目录中的软链接,对应的软件在该运行等级运行时便会自启

手动

```shell
systemctl stop|start|restart 服务名.service
```

## 查看

```shell
systemctl list-unit-files --type=service # 查看所有服务
```

在 CentOS 7 中 telnet 不再属于 xinetd 而是变成了 telnet.socket,可以使用 systemctl 进行控制